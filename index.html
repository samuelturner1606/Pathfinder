<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Pathfinder</title>
		<style>
			html,
			body {
				margin: 0;
				padding: 0;
				background-color: black;
			}
		</style>
	</head>

	<body>
		<canvas></canvas>
		<script>
			const context = document.querySelector("canvas").getContext("2d");

			// resize canvas
			context.canvas.width = window.innerWidth;
			context.canvas.height = window.innerHeight * 0.8;

			// spawn wall objects
			const wallColour = "rgb(255, 255, 255)"; // white
			const objectScalar = 0.03; // percentage of window
			const minWindowLength = Math.min(
				context.canvas.width,
				context.canvas.height
			);
			const objectSize = Math.round(objectScalar * minWindowLength);
			const numOfWalls = objectSize * 10;
			context.fillStyle = wallColour;

			for (let i = 0; i < numOfWalls; i++) {
				let x = Math.random() * context.canvas.width;
				let y = Math.random() * context.canvas.height;
				context.beginPath();
				context.arc(x, y, objectSize, 0, Math.PI * 2, false);
				context.fill();
			}

			// spawn other objects
			function collided(topLeftX, topLeftY) {
				let d = objectSize - 1;
				positions = [
					[topLeftX + d / 2, topLeftY + d / 2], // middle
					[topLeftX, topLeftY], // top left
					[topLeftX + d, topLeftY], // top right
					[topLeftX + d, topLeftY + d], // bottom right
					[topLeftX, topLeftY + d], // bottom left
					[topLeftX + d / 2, topLeftY], // top middle
					[topLeftX + d, topLeftY + d / 2], // right middle
					[topLeftX + d / 2, topLeftY + d], // bottom middle
					[topLeftX, topLeftY + d / 2] // left middle
				];

				for (const pos of positions) {
					let pixel = context.getImageData(
						Math.round(pos[0]),
						Math.round(pos[1]),
						1,
						1
					);
					let rgb =
						"rgb(" +
						pixel.data[0] +
						", " +
						pixel.data[1] +
						", " +
						pixel.data[2] +
						")";
					if (rgb != "rgb(0, 0, 0)") {
						// if rgb isn't canvas background
						return rgb;
					}
				}
			}

			const startColour = "rgb(0, 0, 255)"; // blue
			const endColour = "rgb(255, 255, 0)"; // yellow
			const portalColour = "rgb(0, 255, 0)"; // green
			const coordArray = [];
			const portalArray = [];

			function spawnValidObject(objectColour) {
				do {
					var spawnX = Math.round(
						Math.random() * (context.canvas.width - objectSize)
					);
					var spawnY = Math.round(
						Math.random() * (context.canvas.height - objectSize)
					);
				} while (collided(spawnX, spawnY) != undefined); // find new spawn if objects occupy previous spawn
				context.fillStyle = objectColour;
				context.fillRect(spawnX, spawnY, objectSize, objectSize);
				if (objectColour == startColour) {
					coordArray.push([spawnX, spawnY]);
				} else if (objectColour == portalColour) {
					portalArray.push([spawnX, spawnY]);
				}
			}

			spawnValidObject(startColour);
			for (let i = 0; i < 3; i++) {
				spawnValidObject(endColour);
			}
			for (let i = 0; i < 5; i++) {
				spawnValidObject(portalColour);
			}

			// create coord map that expands from start
			coordColour = "rgb(0, 255, 255)";

			function createCoordMap(coord) {
				const x = coord[0];
				const y = coord[1];
				const d = objectSize;
				let adjCoordArray = [
					[x - d, y - d], // NW
					[x + d, y + d], // SE
					[x - d, y + d], // SW
					[x + d, y - d], // NE
					[x - d, y], // W
					[x, y + d], // S
					[x, y - d], // N
					[x + d, y] // E
				];
				for (const adjCoord of adjCoordArray) {
					if (
						// if adjCoord is within canvas
						0 < adjCoord[0] &&
						adjCoord[0] < context.canvas.width - objectSize &&
						0 < adjCoord[1] &&
						adjCoord[1] < context.canvas.height - objectSize
					) {
						if (collided(adjCoord[0], adjCoord[1]) == undefined) {
							context.fillRect(
								adjCoord[0],
								adjCoord[1],
								objectSize,
								objectSize
							);
							coordArray.push(adjCoord);
						}
					}
				}
			}

			context.fillStyle = coordColour;
			coordIndex = 0;
			(function loop() {
				if (coordArray[coordIndex] != undefined) {
					window.requestAnimationFrame(loop);
					createCoordMap(coordArray[coordIndex]);
					coordIndex++;
				} else {
					console.log("end");
				}
			})();
		</script>
	</body>
</html>
